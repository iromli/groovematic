<!DOCTYPE html>
<html>
    <head>
    
        <meta http-equiv="content-type" content="text/html; charset=utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Feature Flags in Flask</title>
        
            <link href="//fonts.googleapis.com/css?family=Droid+Sans:400,700" rel="stylesheet" type="text/css">
        
        <link rel="shortcut icon" href="/img/favicon.ico" type="image/x-icon" />
        <link rel="apple-touch-icon" href="/img/logo.png"/>
        
            
            <link href="http://groovematic.com/feed.xml" rel="alternate" type="application/atom+xml" title="Groovematic" />
        
        <link media="all" href="/css/main.css" rel="stylesheet" />
    
        <meta name="description" content="__Headups: It&#39;s worth noting that although this po..." />
        <meta name="keywords" content="" />
    </head>
    <body>
        <section class="site-nav">
    <header>
        <nav id="navigation">
            
            
                <a href="/">Blog</a>
            
                <a href="https://github.com/iromli">Projects</a>
            
                <a href="/talks/">Talks</a>
            
                <a href="/about/">About</a>
            
        </nav>

        
        <nav class="tagline">
            <span>A moo-saa-fir and his undercover mission</span>
            
                <a href="/" class="btn btn-outline">Groovematic</a>
            
        </nav>
        
    </header>
</section>
    

    <article>
        
        <div class="container">
            <header>
                <div class="meta">
                    By <address><span rel="author" title="Isman Firmansyah">Isman Firmansyah</span> &mdash;
                    <time pubdate datetime="2014-14-October" title="October 14, 2014">October 14, 2014</time>
                </div>
                <h1 class="title">Feature Flags in Flask</h1>
                
            </header>

            <section>
                <p><strong>Headups: It's worth noting that although this post is about feature flags in Flask, you may find something useful
that inspires you ... hopefully.</strong></p>
<p><img alt="flag" class="img-thumbnail" src="/img/2014/10/iwojima-lego.jpg"/></p>
<p>There's a time when we have one or more unfinished features,
but we need to push our code into production.
Depends on our usecase, a <a href="http://martinfowler.com/bliki/FeatureBranch.html">feature branch</a>
approach may work best for us.
But there's an al&shy;ter&shy;na&shy;tive called <strong>feature flag</strong> (also known as <a href="http://martinfowler.com/bliki/FeatureToggle.html">feature toggle</a>).
The latter approach keeps us away from <strong>merging complexity</strong> introduced by the former,
especially if we have a long-running release cycle.</p>
<h3>State is Our Friend</h3>
<p>The main idea of feature flag is to enable/disable particular features of our app simply by toggling
a state tied to each feature we want to expose/unexpose.
These states might be stored in and loaded from database, con&shy;fig&shy;u&shy;ra&shy;tion file, etc.</p>
<p>A simple example of feature flag im&shy;ple&shy;men&shy;ta&shy;tion is to enable/disable, let's say a secret page in our web app.</p>
<p>First things first, store the state elsewhere (database, config file, etc) as unfinished feature.
When a request hits the secret page, checks the state of that feature, then bail out — since it's an unfinished feature.
<img alt="disabled state" class="img-thumbnail" src="/img/2014/10/state-disabled.png"/></p>
<p>Now, whenever we want to expose the secret page, simply change the state as finished.
Make sure the page is enabled when request comes in.</p>
<p><img alt="enabled state" class="img-thumbnail" src="/img/2014/10/state-enabled.png"/></p>
<p>By mangling the state, we can keep focus on writing code without worrying unfinished features got leaked to the world — unless we ac&shy;ci&shy;den&shy;tal&shy;ly expose the features though.</p>
<h3>Flask-Fea&shy;ture&shy;Flags</h3>
<p>As I work primarily in <a href="http://flask.pocoo.org/">Flask</a> nowadays,
I've found that <a href="https://github.com/trustrachel/Flask-FeatureFlags">Flask-Fea&shy;ture&shy;Flags</a> extension gives me everything I need (for now),
and it's relatively easy to use.</p>
<p>Things to remember about Fea&shy;ture&shy;Flags:</p>
<ul>
<li>By default, the extension loads states from app's config; most of the time it will be a Python module.</li>
<li>By default, the extension uses <code>dict</code> with a specific format, e.g. <code>FEATURE_FLAGS = {"any_feature_name": True}</code>.</li>
<li>The extension has <a href="https://flask-featureflags.readthedocs.org/en/latest/contrib.html">contrib</a> modules, including interface to load states from database and <a href="https://github.com/trustrachel/Flask-FeatureFlags/blob/73a960f62e4f504452538e0a5f56ace08ea68390/CHANGES.rst#051-october-13-2014">inline</a> string format.</li>
</ul>
<h4>Working with Inline Format</h4>
<p>Since I rarely using database to store con&shy;fig&shy;u&shy;ra&shy;tion, I choose inline format introduced since <code>0.6-dev</code> version and it's not available at PyPI yet;
hence to install the bleeding edge version, we need to pull it from GitHub.</p>
<div class="highlight"><pre><span class="c"># install bleeding edge version of Flask-FeatureFlags</span>
pip install -e git+https://github.com/trustrachel/Flask-FeatureFlags@02fe552ea907d9f2da271e191a9e7c5f4ff21a12#egg<span class="o">=</span>Flask_FeatureFlags-master
</pre></div>


<p>One notable difference with default format is, instead of specifying features in <code>dict</code>,
inline format recognizes the features in plain string with <code>FEATURE_FLAGS_X</code> format, where <code>X</code> is the actual feature name — all in uppercase.</p>
<div class="highlight"><pre><span class="c"># default format</span>
<span class="n">FEATURE_FLAGS</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">&quot;secret_page&quot;</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span>
    <span class="s">&quot;another_secret_page&quot;</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
<span class="p">}</span>

<span class="c"># inline format</span>
<span class="n">FEATURE_FLAGS_SECRET_PAGE</span> <span class="o">=</span> <span class="bp">True</span>
<span class="n">FEATURE_FLAGS_ANOTHER_SECRET_PAGE</span> <span class="o">=</span> <span class="bp">False</span>
</pre></div>


<p>The dis&shy;ad&shy;van&shy;tage of this inline format is we have more characters to type.
But, by specifying feature using inline format, it plays nicely with <a href="https://pypi.python.org/pypi/flask-appconfig">Flask-AppConfig</a>.
This means I can enable/disable feature using en&shy;vi&shy;ron&shy;ment variable exported from command line,
as Flask-AppConfig follows the <a href="http://12factor.net/config">The Twelve-Factor App</a> config manifesto.</p>
<p>To install Flask-AppConfig, simply use <code>pip</code> from a shell:</p>
<div class="highlight"><pre>pip install flask-appconfig
</pre></div>


<p>Once Flask-AppConfig is configured properly, enabling/disabling a feature is simply typing it from command line.
Remember the <code>FEATURE_FLAGS_ANOTHER_SECRET_PAGE</code> line above?</p>
<p>Let's enable another secret page feature from a shell:</p>
<div class="highlight"><pre><span class="c"># set the value as Python truth-y</span>
<span class="c"># notice the prefix before FEATURE_FLAGS_ANOTHER_SECRET_PAGE?</span>
<span class="c"># it&#39;s convention used by Flask-AppConfig,</span>
<span class="c"># and it doesnt&#39; have to be APP though</span>
<span class="nv">APP_FEATURE_FLAGS_ANOTHER_SECRET_PAGE</span><span class="o">=</span>1
</pre></div>


<p>In the last section of this post, I will give you snippet to implement the "secret page" example above using Flask-Fea&shy;ture&shy;Flags and Flask-AppConfig.</p>
<h4>Flag 'em Run 'em</h4>
<p>Given the "secret page" example above, let's implement it in a Flask app.
Don't forget to install Flask-Fea&shy;ture&shy;Flags and Flask-AppConfig first.</p>
<div class="highlight"><pre><span class="c"># app.py</span>
<span class="kn">import</span> <span class="nn">flask</span>
<span class="kn">import</span> <span class="nn">flask_featureflags</span> <span class="kn">as</span> <span class="nn">feature</span>
<span class="kn">from</span> <span class="nn">flask.ext.appconfig</span> <span class="kn">import</span> <span class="n">AppConfig</span>
<span class="kn">from</span> <span class="nn">flask_featureflags.contrib.inline</span> <span class="kn">import</span> <span class="n">InlineFeatureFlag</span>

<span class="n">FEATURE_FLAGS_SECRET_PAGE</span> <span class="o">=</span> <span class="bp">False</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">flask</span><span class="o">.</span><span class="n">Flask</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>

<span class="c"># As we&#39;re passing `__name__` when creating Flask app,</span>
<span class="c"># it means our `app.name` equals to &quot;app&quot;.</span>
<span class="c"># Flask-AppConfig will recognize any `APP_*` env variable.</span>
<span class="c"># If we need to change the prefix, set `app.name`</span>
<span class="c"># into something else, before initializing the extension.</span>

<span class="c"># Loads default config from current module</span>
<span class="n">appconfig</span> <span class="o">=</span> <span class="n">AppConfig</span><span class="p">(</span><span class="n">app</span><span class="p">,</span> <span class="n">default_settings</span><span class="o">=</span><span class="n">__name__</span><span class="p">)</span>

<span class="n">flags</span> <span class="o">=</span> <span class="n">feature</span><span class="o">.</span><span class="n">FeatureFlag</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>
<span class="n">flags</span><span class="o">.</span><span class="n">add_handler</span><span class="p">(</span><span class="n">InlineFeatureFlag</span><span class="p">())</span>


<span class="nd">@app.route</span><span class="p">(</span><span class="s">&quot;/&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">index</span><span class="p">():</span>
    <span class="k">return</span> <span class="s">&quot;Homepage&quot;</span>


<span class="nd">@app.route</span><span class="p">(</span><span class="s">&quot;/secret&quot;</span><span class="p">)</span>
<span class="nd">@feature.is_active_feature</span><span class="p">(</span><span class="s">&quot;SECRET_PAGE&quot;</span><span class="p">,</span> <span class="n">redirect_to</span><span class="o">=</span><span class="s">&quot;/&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">secret_page</span><span class="p">():</span>
    <span class="k">return</span> <span class="s">&quot;Secret Page&quot;</span>

<span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>


<p>To test whether "secret page" is disabled, simply run:</p>
<div class="highlight"><pre>python app.py
</pre></div>


<p>To enable "secret page" from a shell, run:</p>
<div class="highlight"><pre><span class="nv">APP_FEATURE_FLAGS_SECRET_PAGE</span><span class="o">=</span>1 python app.py
</pre></div>


<p>It's quite simple isn't it?</p>
                
                    <div class="social">
                        <div>
                            <a href="https://twitter.com/share" class="twitter-share-button"  data-text="Feature Flags in Flask" data-related="iromli">Tweet</a>
                        </div>
                        

                        

                        
                        <div>
                            <div class="g-plusone" data-size="medium"></div>
                        </div>
                        
                    </div>
                
            </section>

            <footer>
                <address>
                    <img src="/img/authors/iromli.jpeg">
                    Written by <strong><a rel="author" href="/" title="Isman Firmansyah">Isman Firmansyah</a></strong><br>
                    <span class="muted"></span>
                    
                        <div class="follow">
                            <a href="https://twitter.com/iromli" class="twitter-follow-button" data-show-count="false" data-dnt="true">Follow @</a>
                            <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
                        </div>
                    
                </address>
            </footer>
            
            <section id="disqus_thread"></section>
            
        </div>
    </article>
<footer class="site-footer">
    <div class="container">
        &copy; 2014

        
            <nav>
            
                <a href="/">Blog</a> &middot;
            
                <a href="https://github.com/iromli">Projects</a> &middot;
            
                <a href="/talks/">Talks</a> &middot;
            
                <a href="/about/">About</a> 
            
            </nav>
        

        <nav class="social">
            
            <a href="https://twitter.com/iromli" title="Follow on Twitter" target="_blank"><i class="icon icon-twitter black"></i></a>
            
            
                
                <a href="/feed.xml" title="Atom Feed">
                    <i class="icon icon-rss black"></i>
                </a>
            
        </nav>
        
            <p><em><a href='https://github.com/iromli/groovematic'>Use the source, Luke!</a></em></p>
        
    </div>
</footer>
        
    
            <script type="text/javascript" src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
        
    
        <script type="text/javascript">
            /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
            var disqus_shortname = 'groovematic'; // required: replace example with your forum shortname
            if (window.location.hostname != 'localhost') {
                /* * * DON'T EDIT BELOW THIS LINE * * */
                (function () {
                    var s = document.createElement('script'); s.async = true;
                    s.type = 'text/javascript';
                    s.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
                    (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);}());
            }
        </script>
    
    
    <script>
        !function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');
    </script>





    <script type="text/javascript">
        (function() {
            var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
            po.src = 'https://apis.google.com/js/plusone.js';
            var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
        })();
    </script>


    </body>
</html>